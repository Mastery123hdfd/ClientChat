<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Client</title>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        body {
            background: rgb(18, 19, 27);
            font-family: 'Comfortaa', sans-serif;
            font-size: 14px;
            color: white;
            padding: 20px;
        }

        #log {
            border: 1px solid #ffffff;
            background: #222;
            padding: 10px;
            color: white;
            height: 200px;
            overflow-y: auto;
            border-radius: 6px;
            box-shadow: inset 0 0 6px #0d0b24;
        }

        #msg {
            width: 300px;
            padding: 8px;
            background: #333;
            color: white;
            border: 1px solid #ffffff;
            border-radius: 6px;
            box-shadow: inset 0 0 4px #000;
            font-family: 'Comfortaa', sans-serif;
            font-size: 14px;
        }

        #clickbutton {
            padding: 8px 14px;
            margin-left: 6px;
            background: #2c2c2c;
            color: rgb(255, 255, 255);
            border: 1px solid #ffffff;
            border-radius: 6px;
            font-family: 'Comfortaa', sans-serif;
            cursor: pointer;
            box-shadow: inset 0 0 4px #202020;
        }

        #clickbutton:hover {
            background: #555;
        }

    </style>
</head>
<body>

<h2>WebSocket Client</h2>

<div id="log"></div>

<br>

<input id="msg" placeholder="Type a message">
<button id = "clickbutton" onclick="sendMessage()">Send</button>

<script>
    

    const logBox = document.getElementById("log");
    log("Connecting to server. This may take a long time if no one has chatted on the server for some time.");
    const ws = new WebSocket("wss://clientserveriep2026me.onrender.com");
    const box = document.getElementById("msg");
    const btn = document.getElementById("clickbutton");

    

    box.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            btn.click();   
        }
    });

    const data = JSON.parse(msg);

    if (data.type === "clearHistory") {
        chatHistory = [];
        document.getElementById("log").innerHTML = "";
        return;
    }

    function log(text) {
        const p = document.createElement("p");
        p.textContent = text;
        logBox.appendChild(p);
        logBox.scrollTop = logBox.scrollHeight;
    }

    ws.onopen = () => {
        log("Connected to server");
    };

    ws.onmessage = (event) => {
        log("" + event.data);
    };

    ws.onclose = () => {
        log("Connection closed. Retrying in 3 seconds...");
        setTimeout(() => location.reload(), 3000);
    };

    ws.onerror = (err) => {
        log("WebSocket error");
        console.error(err);
    };

    function sendMessage() {
        
        const text = document.getElementById("msg").value;
        ws.send(text);
        document.getElementById("msg").value = "";
    }
</script>

</body>
</html>